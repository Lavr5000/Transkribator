---
phase: 01-critical-bug-fixes
plan: 03
type: execute
wave: 2
depends_on: ["01-01", "01-02"]
files_modified:
  - src/backends/whisper_backend.py
  - src/backends/sherpa_backend.py
  - RemotePackage/src/backends/whisper_backend.py
  - RemotePackage/src/backends/sherpa_backend.py
autonomous: true

must_haves:
  truths:
    - "Все изменения из плана 01-01 синхронизированы с RemotePackage"
    - "Все изменения из плана 01-02 синхронизированы с RemotePackage"
    - "Серверная версия использует те же параметры модели"
  artifacts:
    - path: "RemotePackage/src/backends/whisper_backend.py"
      contains: 'language="ru"'
      contains: 'beam_size=5'
      contains: 'temperature=0.0'
    - path: "RemotePackage/src/backends/sherpa_backend.py"
      contains: "from_nemo_transducer"
      contains: "max_active_paths=4"
  key_links:
    - from: "src/backends"
      to: "RemotePackage/src/backends"
      via: "File synchronization"
      pattern: "Identical parameter values across both directories"
---

<objective>
Synchronize improvements between client and server.

**What:**
Ensure RemotePackage (server) has identical backend improvements as local client.

**Why:**
Client-server architecture requires both sides use same model parameters for consistent results. Server processes remote audio, so must have same accuracy improvements.

**Output:**
Synchronized backends across src/ and RemotePackage/src/ directories.
</objective>

<execution_context>
@C:\Users\user\.claude\get-shit-down\workflows\execute-plan.md
@C:\Users\user\.claude\get-shit-down\templates\summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Directory structure:
# Local client: C:\Users\user\.claude\0 ProEKTi\Transkribator\src\backends\
# Server package: C:\Users\user\.claude\0 ProEKTi\Transkribator\RemotePackage\src\backends\

# After plans 01-01 and 01-02 complete, verify RemotePackage has same changes
</context>

<tasks>

<task type="auto">
  <name>Verify and synchronize backend files</name>
  <files>RemotePackage/src/backends/whisper_backend.py, RemotePackage/src/backends/sherpa_backend.py</files>
  <action>
Verify RemotePackage has identical changes to src/ backends:

1. Check whisper_backend.py sync:
```bash
# Compare language parameter
grep -n 'language = "ru"' src/backends/whisper_backend.py RemotePackage/src/backends/whisper_backend.py

# Compare beam_size
grep -n 'beam_size=5' src/backends/whisper_backend.py RemotePackage/src/backends/whisper_backend.py

# Compare temperature
grep -n 'temperature=0.0' src/backends/whisper_backend.py RemotePackage/src/backends/whisper_backend.py
```

If any check shows differences, copy the working version from src/ to RemotePackage/:
```bash
# If RemotePackage missing changes, copy from src/
cp src/backends/whisper_backend.py RemotePackage/src/backends/whisper_backend.py
```

2. Check sherpa_backend.py sync:
```bash
# Compare Transducer mode
grep -n "from_nemo_transducer" src/backends/sherpa_backend.py RemotePackage/src/backends/sherpa_backend.py

# Compare max_active_paths
grep -n "max_active_paths=4" src/backends/sherpa_backend.py RemotePackage/src/backends/sherpa_backend.py

# Compare model file checks
grep -n "decoder.onnx\|joiner.onnx" src/backends/sherpa_backend.py RemotePackage/src/backends/sherpa_backend.py
```

If differences found, copy from src/:
```bash
cp src/backends/sherpa_backend.py RemotePackage/src/backends/sherpa_backend.py
```

3. Verify TranscriberServer uses same parameters:
```bash
# Check if server imports backends correctly
grep -n "whisper_backend\|sherpa_backend" RemotePackage/src/server/*.py
```
  </action>
  <verify>
diff -u src/backends/whisper_backend.py RemotePackage/src/backends/whisper_backend.py | head -20
diff -u src/backends/sherpa_backend.py RemotePackage/src/backends/sherpa_backend.py | head -20
  </verify>
  <done>All backend files are identical between src/ and RemotePackage/src/</done>
</task>

</tasks>

<verification>
After implementation:
1. diff shows no differences (or only minor whitespace)
2. grep confirms identical parameters in both directories
3. Server imports correct backend modules
</verification>

<success_criteria>
- [ ] RemotePackage/whisper_backend.py identical to src/ version
- [ ] RemotePackage/sherpa_backend.py identical to src/ version
- [ ] Server will use optimized parameters when processing remote audio
- [ ] Client and server produce consistent results
</success_criteria>

<output>
After completion, create .planning/phases/01-critical-bug-fixes/01-03-SUMMARY.md
</output>
