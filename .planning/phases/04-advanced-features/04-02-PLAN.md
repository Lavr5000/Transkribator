---
wave: 1
depends_on: []
files_modified:
  - src/config.py
  - src/main_window.py
  - src/text_processor_enhanced.py
  - src/transcriber.py
autonomous: true
must_haves:
  - user_dictionary field added to Config (list of dict with wrong, correct, case_sensitive)
  - New "Dictionary" tab in SettingsDialog with QTableWidget
  - Add/Edit/Delete functionality for dictionary entries
  - Import/Export buttons for bulk operations (JSON format)
  - EnhancedTextProcessor applies user dictionary corrections
---

# Plan 04-02: User-Defined Correction Dictionary

**Objective:** Allow users to add custom word corrections (e.g., "торопинка" → "переписка")

## Tasks

<tasks>
<task id="04-02-01">
<summary>Add user_dictionary field to Config</summary>
<details>
- Add `user_dictionary: list = field(default_factory=list)` to Config in src/config.py
- Define structure: {"wrong": str, "correct": str, "case_sensitive": bool}
- Update Config.load() to handle missing/invalid user_dictionary
- Default to empty list if not present
</details>
<verification>Config loads with empty user_dictionary by default</verification>
</task>

<task id="04-02-02">
<summary>Create Dictionary tab in SettingsDialog</summary>
<details>
- Add third tab "Dictionary" to QTabWidget
- Create QTableWidget with columns: "Wrong", "Correct", "Case Sensitive?"
- Add "Add Word" button → opens QDialog with form fields
- Add "Edit" and "Delete" buttons for selected row
- Add "Import" and "Export" buttons
- Add live search filter at top of table
</details>
<verification>Dictionary tab shows table with 3 columns and 5 buttons</verification>
</task>

<task id="04-02-03">
<summary>Implement Add/Edit Word dialog</summary>
<details>
- Create AddWordDialog class (inherits QDialog)
- Form fields:
  * QLineEdit "Wrong spelling" (what to replace)
  * QLineEdit "Correct spelling" (replacement)
  * QCheckBox "Case sensitive"
- Validation: both fields required, not identical
- Return dictionary entry dict on OK
</details>
<verification>Dialog validates input and returns proper dict structure</verification>
</task>

<task id="04-02-04">
<summary>Implement CRUD operations for dictionary</summary>
<details>
- Add `_add_dictionary_entry()` method → shows dialog, adds to config
- Add `_edit_dictionary_entry()` → pre-fills dialog, updates entry
- Add `_delete_dictionary_entry()` → removes selected row
- Add `_import_dictionary()` → load JSON file, merge with existing
- Add `_export_dictionary()` → save to JSON file
- Update config.user_dictionary and save() on each change
- Refresh table display after operations
</details>
<verification>Add/Edit/Delete/Import/Export all work correctly</verification>
</task>

<task id="04-02-05">
<summary>Integrate user dictionary into text processing</summary>
<details>
- Pass user_dictionary to EnhancedTextProcessor in Transcriber.__init__()
- Add apply_user_dictionary() method to EnhancedTextProcessor
- Apply user dictionary BEFORE existing correction rules
- Match logic: exact string replacement, respect case_sensitive flag
- Log applied corrections for debugging
</details>
<verification>User dictionary corrections appear in transcribed text</verification>
</task>

<task id="04-02-06">
<summary>Reload text processor when dictionary changes</summary>
<details>
- Add _rebuild_text_processor() method in MainWindow
- Call when dictionary is modified in settings
- Signal connection from SettingsDialog to MainWindow
- Pass updated user_dictionary to new EnhancedTextProcessor instance
</details>
<verification>Changes to dictionary take effect immediately</verification>
</task>
</tasks>

## Success Criteria

- [ ] User can add custom word corrections via UI
- [ ] Dictionary entries are persisted in config.json
- [ ] Corrections apply to all future transcriptions
- [ ] Import/Export works for backup/sharing
- [ ] Table search filters entries in real-time

## Example Dictionary Entries

```json
[
  {"wrong": "торопинка", "correct": "переписка", "case_sensitive": false},
  {"wrong": "JTimon", "correct": "Дмитрий", "case_sensitive": false},
  {"wrong": "API", "correct": "АПИ", "case_sensitive": true}
]
```

## Notes

- User dictionary applies BEFORE built-in rules (higher priority)
- Case-insensitive matches use str.lower() comparison
- Import merges with existing entries (no duplicates by "wrong" field)
- Consider adding "Test" button to preview corrections (future)
