# Phase 3: Text Processing Enhancement - Context

**Gathered:** 2026-01-27
**Status:** Ready for planning

## Phase Boundary

Post-обработка текста для исправления ошибок распознавания русской речи. EnhancedTextProcessor расширяется с 50 до 100+ правил коррекции. Фокус на фонетических, морфологических ошибках и именах собственных. Не включает новые UI элементы (Phase 4).

## Implementation Decisions

### Фонетические коррекции
- **Базовый набор:** 6 пар звонких/глухих согласных
  - б ↔ п (был → пыл)
  - в ↔ ф (вот → фот)
  - г ↔ к (год → код)
  - д ↔ т (дом → том)
  - з ↔ с (зал → сал)
  - ж ↔ ш (жал → шал)
- **НЕ включать:** мягкие/твердые, й/и, безударные о/а
- **Применение:** контекстно-зависимое (оглушение в конце слова, озвончение перед звонкими)

### Морфология
- **Уровень:** Род + Падежи
- **Род:** согласование прилагательных/глаголов с существующим (он вышел → она вышла)
- **Падежи:** исправление окончаний (идту → иду, стола → стол, ideš → ideš')
- **НЕ включать:** спряжения глаголов, множественное число (сложно для контекста)

### Словарь имен собственных
- **Объем:** 500-1000 entries (минимум для MVP)
- **Источник:** Внешний источник (GitHub datasets, готовые списки)
- **Категории:** имена (Denis, Сергей, Александр), города (Москва, Санкт-Петербург), страны (Россия)
- **Обновление:** статический список на старте, без runtime загрузки

### Пунктуация и адаптивность
- **Уровень:** Капитализация + базовая пунктуация
- **Капитализация:** заглавная после ".", "!", "?"
- **Базовая пунктуация:** восстановление пропущенных точек в конце предложений, запятых перед "и", "а", "но"
- **Адаптивность для Whisper:** пропускать обработку пунктуации (Whisper уже даёт пунктуацию), только капитализация и мелкие правки
- **Sherpa/Podlodka:** полная обработка (нет пунктуации на выходе)

### Порядок реализации
1. Фонетика (базовые 6 пар)
2. Морфология (род + падежи)
3. Словарь имен (500-1000 entries)
4. Пунктуация и адаптивность

### Claude's Discretion
- Точные алгоритмы контекстной коррекции (как определять контекст для звонких/глухих)
- Формат хранения словаря (JSON, Python dict, SQLite)
- Метрики для измерения эффективности правил (CER до/после)
- Интеграция с EnhancedTextProcessor (методы vs классы)

## Specific Ideas

- Шумоподавление Phase 2 дало чистый аудиосигнал — теперь текстовые ошибки остались
- WhisperTyping показывает что слово-в-слово возможно с хорошим post-processing
- Базовый набор фонетики — это 80% ошибок при 20% усилий

## Deferred Ideas

- Полная морфология (спряжения, числа) — отложено до Phase 4
- Пользовательский словарь терминов — Phase 4 (CFG-02)
- Продвинутая пунктуация (кавычки, тире, двоеточия) — Phase 4

---

*Phase: 03-text-processing*
*Context gathered: 2026-01-27*
